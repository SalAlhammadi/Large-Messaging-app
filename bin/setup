#!/bin/bash
#
# Script for ejabberd autoconfiguration on local machine
#
# @see Here are project requirements for a full blown compile
#      - erlang (v18.0 used during latest compile)
#      - gcc, autotools, binutils (for dealing with some compile stuff


# Configuration settings
DIR_SRC=/home/ben/lavori/ejabberd.server/ejabberd
DIR_TARGET=/opt/ejabberd

DEBUG=--enable-debug
#DEBUG=--disable-debug




# Business logic
keypress() {
    echo -n "any key to continue..."
    read -n 1 junk
}
init() {
    echo "Installation dir cleanup ($DIR_TARGET)"
    rm -rf $DIR_TARGET/*
    ls -la $DIR_TARGET/
}
clean() {
    echo "Source code cleanup"
    make clean
    make distclean
}
configure() {
    clean
    echo "Autogen"
    ./autogen.sh
    keypress
    echo "Configure"
    ./configure --prefix=$DIR_TARGET \
                --sysconfdir=$DIR_TARGET/conf \
                --enable-lager $DEBUG
}
cd $DIR_SRC >/dev/null 2>&1
OPTION=$1
case $OPTION in
    init)
        init
        ;;
    clean)
        clean
        ;;
    make)
        configure
        make
        ;;
    install)
        make install
        ;;
    all)
        init
        configure
        keypress
        make
        keypress
        make install
        ;;
    *)
        echo -e "\nUsage:     [NOTE: Run this script from GIT source code dir $DIR_SRC]"
        echo -e "    '`basename $0` [option]' "
        echo -e "              init   Init installation directory (wipe it)"
        echo -e "              clean  Clean ejabberd source code and configure options"
        echo -e "              make   Clean/Configure/Make ejabberd source code"
        echo -e "              all    init+make+install"
        echo -e ""
        cd - >/dev/null 2>&1
        exit 1
        ;;
esac
cd - >/dev/null 2>&1
